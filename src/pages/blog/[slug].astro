---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map((entry: CollectionEntry<'blog'>) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<'blog'>;
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// Function to format date
const formatDate = (date: Date): string => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};

// Social Media metadata
const ogTitle = entry.data.title;
const ogDescription = entry.data.description || entry.data.title;
const ogImage = entry.data.image || '/og-image.png';
const ogUrl = `https://saferrai-lab.org/blog/${entry.slug}`;
---

<Layout 
  title={`${entry.data.title} - SAFERR AI Lab`}
  description={ogDescription}
>
  {/* Primary Meta Tags */}
  <meta name="title" content={ogTitle} />
  <meta name="description" content={ogDescription} />

  {/* Open Graph / Facebook */}
  <meta property="og:type" content="article" />
  <meta property="og:url" content={ogUrl} />
  <meta property="og:title" content={ogTitle} />
  <meta property="og:description" content={ogDescription} />
  <meta property="og:image" content={ogImage} />
  <meta property="og:site_name" content="SAFERR AI Lab" />
  <meta property="og:locale" content="en_US" />
  <meta property="article:author" content={entry.data.author} />
  <meta property="article:published_time" content={entry.data.date.toISOString()} />
  <meta property="article:section" content="Blog" />
  {entry.data.tags.map((tag: string) => (
    <meta property="article:tag" content={tag} />
  ))}

  {/* Twitter */}
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content={ogTitle} />
  <meta name="twitter:description" content={ogDescription} />
  <meta name="twitter:image" content={ogImage} />

  {/* LinkedIn */}
  <meta property="linkedin:title" content={ogTitle} />
  <meta property="linkedin:description" content={ogDescription} />
  <meta property="linkedin:image" content={ogImage} />
  <meta property="linkedin:url" content={ogUrl} />

  {/* WhatsApp */}
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  {/* Additional Meta Tags */}
  <meta name="theme-color" content="#3b82f6" />
  <meta name="msapplication-TileColor" content="#3b82f6" />
  <meta name="msapplication-TileImage" content={ogImage} />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="SAFERR AI Lab" />
  <meta name="application-name" content="SAFERR AI Lab" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="mobile-web-app-capable" content="yes" />

  <div class="container mx-auto px-4 py-12">
    <article class="prose prose-lg max-w-3xl mx-auto dark:prose-invert">
      <header class="mb-8 text-center">
        <div class="flex flex-wrap justify-center gap-2 mb-4">
          {entry.data.tags.map((tag: string) => (
            <a href={`/blog/tag/${tag}`} class="inline-block px-3 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors duration-200">
              {tag}
            </a>
          ))}
        </div>
        
        <h1 class="text-4xl font-bold mb-4">{entry.data.title}</h1>
        
        <div class="flex justify-center items-center text-sm text-gray-600 mb-6">
          <span>{entry.data.author}</span>
          <span class="mx-2">â€¢</span>
          <time datetime={entry.data.date.toISOString()}>{formatDate(entry.data.date)}</time>
        </div>
        
        {entry.data.image && (
          <figure class="mb-8">
            <img 
              src={entry.data.image} 
              alt={entry.data.title}
              class="w-full h-auto rounded-lg object-cover" 
            />
          </figure>
        )}
      </header>
      
      <div class="blog-content">
        <Content />
      </div>
      
      <footer class="mt-12 pt-8 border-t">
        <div class="flex flex-wrap justify-between items-center">
          <div>
            <h3 class="text-xl font-bold mb-2">Share this post</h3>
            <div class="flex gap-2">
              <a 
                href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(entry.data.title)}&url=${encodeURIComponent(`https://saferr-ai-lab.org/blog/${entry.slug}`)}`}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center px-4 py-2 text-sm font-medium border border-gray-300 rounded-md hover:bg-gray-100 transition-colors duration-200"
              >
                Twitter
              </a>
              <a 
                href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(`https://saferr-ai-lab.org/blog/${entry.slug}`)}`}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center px-4 py-2 text-sm font-medium border border-gray-300 rounded-md hover:bg-gray-100 transition-colors duration-200"
              >
                LinkedIn
              </a>
              <a 
                href={`mailto:?subject=${encodeURIComponent(entry.data.title)}&body=${encodeURIComponent(`I thought you might find this interesting: https://saferr-ai-lab.org/blog/${entry.slug}`)}`}
                class="inline-flex items-center px-4 py-2 text-sm font-medium border border-gray-300 rounded-md hover:bg-gray-100 transition-colors duration-200"
              >
                Email
              </a>
            </div>
          </div>
          <a href="/blog" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors duration-200">
            Back to Blog
          </a>
        </div>
      </footer>
    </article>
  </div>
</Layout>


  <style is:global>

/* .katex-display {
  display: block;
  text-align: center !important;
  width: 100%;
  margin: 1.5em 0;
} */

/* .blog-content p > .katex {
  display: block;
  text-align: center;
} */

/* .blog-content p:has(> .katexml) {
  text-align: center;
} */


/* .katex-display > .katex {
  display: inline-block !important;
  text-align: center !important;
} */


/* Inline math (e.g., $x + y$) */
.blog-content .katex {
  font-size: 1em;
  /* optional: no extra margin, align with text */
}

/* Block math (e.g., $$x + y$$) */
.blog-content .katex-display {
  display: block;
  margin: 1.5em auto;
  text-align: center;
  font-size: 1.1em;
}


  </style>

<!-- <style is:global>
  /* Base styles for blog content */
  .blog-content {
    line-height: 1.8;
    font-size: 1.1rem;
  }
  
  /* Headings */
  .blog-content h1,
  .blog-content h2,
  .blog-content h3,
  .blog-content h4,
  .blog-content h5,
  .blog-content h6 {
    margin-top: 1.5em;
    margin-bottom: 0.75em;
    font-weight: 700;
    line-height: 1.3;
  }
  
  .blog-content h1 {
    font-size: 2rem;
  }
  
  .blog-content h2 {
    font-size: 1.75rem;
    padding-bottom: 0.3em;
    border-bottom: 1px solid rgba(150, 150, 150, 0.2);
  }
  
  .blog-content h3 {
    font-size: 1.5rem;
  }
  
  .blog-content h4 {
    font-size: 1.25rem;
  }
  
  /* Lists */
  .blog-content ul,
  .blog-content ol {
    padding-left: 1.5em;
    margin: 1em 0;
  }
  
  .blog-content ul li,
  .blog-content ol li {
    margin-bottom: 0.5em;
  }
  
  /* Paragraphs and spacing */
  .blog-content p {
    margin-bottom: 1.5em;
  }
  
  /* Code blocks */
  .blog-content pre {
    padding: 1em;
    border-radius: 0.5em;
    overflow-x: auto;
    background-color: rgba(20, 20, 20, 0.8);
    margin: 1.5em 0;
  }
  
  .blog-content code {
    font-family: 'Fira Code', monospace;
    font-size: 0.9em;
  }
  
  /* Inline code */
  .blog-content p code,
  .blog-content li code {
    padding: 0.2em 0.4em;
    border-radius: 3px;
    font-size: 0.9em;
    background-color: rgba(150, 150, 150, 0.15);
  }
  
  /* Block quotes */
  .blog-content blockquote {
    border-left: 4px solid #3b82f6;
    padding-left: 1em;
    margin-left: 0;
    margin-right: 0;
    font-style: italic;
    background-color: rgba(59, 130, 246, 0.1);
    padding: 1em;
    border-radius: 0 0.5em 0.5em 0;
  }
  
  /* Tables */
  .blog-content table {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5em 0;
  }
  
  .blog-content th,
  .blog-content td {
    border: 1px solid rgba(150, 150, 150, 0.2);
    padding: 0.5em;
    text-align: left;
  }
  
  .blog-content th {
    background-color: rgba(150, 150, 150, 0.1);
  }
  
  /* Images */
  .blog-content img {
    max-width: 100%;
    height: auto;
    border-radius: 0.5em;
    margin: 1.5em auto;
    display: block;
  }
  
  /* Math rendering */
  .math-display {
    overflow-x: auto;
    margin: 1.5em 0;
    padding: 1em;
    background-color: rgba(150, 150, 150, 0.1);
    border-radius: 0.5em;
    text-align: center;
  }
  
  .katex-display {
    overflow-x: auto;
    padding: 0.5em 0;
  }
  
  /* Improving math formula display */
  .katex {
    font-size: 1.1em;
  }
  
  .katex-display > .katex {
    display: inline-block;
    white-space: nowrap;
    max-width: 100%;
    overflow-x: auto;
    text-align: initial;
  }
  
  .katex-display > .katex > .katex-html {
    display: inline-block;
    position: relative;
  }
  
  /* Handle multiline equations */
  .math-display.multi-line {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
</style>  -->