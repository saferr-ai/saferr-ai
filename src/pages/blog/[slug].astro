---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const blogEntries = await getCollection('blog');
  return blogEntries.map((entry: CollectionEntry<'blog'>) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

interface Props {
  entry: CollectionEntry<'blog'>;
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// Function to format date
const formatDate = (date: Date): string => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
};

// Social Media metadata
const ogTitle = `${entry.data.title} - SAFERR AI Lab`;
const ogDescription = entry.data.description || entry.data.title;
const ogImage = entry.data.image ? `https://saferrai-lab.org${entry.data.image}` : 'https://saferrai-lab.org/ogimage.png';
const ogUrl = `https://saferrai-lab.org/blog/${entry.slug}`;
---

<Layout 
  title={ogTitle}
  description={ogDescription}
  image={ogImage}
  url={ogUrl}
>
  

  <div class="container mx-auto px-4 py-12">
    <article class="prose prose-lg max-w-3xl mx-auto dark:prose-invert">
      <header class="mb-8 text-center">
        <div class="flex flex-wrap justify-center gap-2 mb-4">
          {entry.data.tags.map((tag: string) => (
            <a href={`/blog/tag/${tag}`} class="inline-block px-3 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors duration-200">
              {tag}
            </a>
          ))}
        </div>
        
        <h1 class="text-4xl font-bold mb-4">{entry.data.title}</h1>
        
        <div class="flex justify-center items-center text-sm text-gray-600 mb-6">
          <span>{entry.data.author}</span>
          <span class="mx-2">â€¢</span>
          <time datetime={entry.data.date.toISOString()}>{formatDate(entry.data.date)}</time>
        </div>
        
        {entry.data.image && (
          <figure class="mb-8">
            <img 
              src={entry.data.image} 
              alt={entry.data.title}
              class="w-full h-auto rounded-lg object-cover" 
            />
          </figure>
        )}
      </header>
      
      <div class="blog-content">
        <Content />
      </div>
      
      <footer class="mt-12 pt-8 border-t">
        <div class="flex flex-wrap justify-between items-center">
          <div>
            <h3 class="text-xl font-bold mb-2">Share this post</h3>
            <div class="flex gap-2">
              <a 
                href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(entry.data.title)}&url=${encodeURIComponent(`https://saferr-ai-lab.org/blog/${entry.slug}`)}`}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center px-4 py-2 text-sm font-medium border border-gray-300 rounded-md hover:bg-gray-100 transition-colors duration-200"
              >
                Twitter
              </a>
              <a 
                href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(`https://saferr-ai-lab.org/blog/${entry.slug}`)}`}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center px-4 py-2 text-sm font-medium border border-gray-300 rounded-md hover:bg-gray-100 transition-colors duration-200"
              >
                LinkedIn
              </a>
              <a 
                href={`mailto:?subject=${encodeURIComponent(entry.data.title)}&body=${encodeURIComponent(`I thought you might find this interesting: https://saferr-ai-lab.org/blog/${entry.slug}`)}`}
                class="inline-flex items-center px-4 py-2 text-sm font-medium border border-gray-300 rounded-md hover:bg-gray-100 transition-colors duration-200"
              >
                Email
              </a>
            </div>
          </div>
          <a href="/blog" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors duration-200">
            Back to Blog
          </a>
        </div>
      </footer>
    </article>
  </div>
</Layout>

<style is:global>
/* Inline math (e.g., $x + y$) */
.blog-content .katex {
  font-size: 1em;
}

/* Block math (e.g., $$x + y$$) */
.blog-content .katex-display {
  display: block;
  margin: 1.5em auto;
  text-align: center;
  font-size: 1.1em;
}
</style>